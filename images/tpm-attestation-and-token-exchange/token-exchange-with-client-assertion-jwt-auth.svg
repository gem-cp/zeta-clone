<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="2623px" preserveAspectRatio="none" style="width:1464px;height:2623px;background:#FFFFFF;" version="1.1" viewBox="0 0 1464 2623" width="1464px" zoomAndPan="magnify"><defs/><g><rect fill="#F8F8FF" height="2611.4375" style="stroke:#181818;stroke-width:0.5;" width="977.2695" x="39.793" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="519.9658" y="15.2822">LEI</text><rect fill="#E6E6FA" height="2594.7969" style="stroke:#181818;stroke-width:0.5;" width="758.978" x="39.793" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="380.1853" y="31.9229">Prim&#228;rsystem</text><rect fill="#F4A460" height="2578.1563" style="stroke:#181818;stroke-width:0.5;" width="89" x="39.793" y="39.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="51.793" y="48.5635">ZETA Client</text><rect fill="#C9FFC9" height="2611.4375" style="stroke:#181818;stroke-width:0.5;" width="429.8926" x="1029.0625" y="6"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1219.6484" y="15.2822">Anbieter</text><rect fill="#F4A460" height="2594.7969" style="stroke:#181818;stroke-width:0.5;" width="429.8926" x="1029.0625" y="22.6406"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1210.8643" y="31.9229">ZETA Guard</text><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="2413.2344" width="8" x="15.8965" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="19.3965" x2="19.3965" y1="126.5625" y2="2539.7969"/></g><g><title>ZETA</title><rect fill="#000000" fill-opacity="0.00000" height="2413.2344" width="8" x="80.793" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="84.293" x2="84.293" y1="126.5625" y2="2539.7969"/></g><g><title/><rect fill="#FFFFFF" height="2400.2344" style="stroke:#181818;stroke-width:1;" width="10" x="79.293" y="134.5625"/></g><g><title>ZETA Attestation Service</title><rect fill="#000000" fill-opacity="0.00000" height="2413.2344" width="8" x="401.1709" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="404.6709" x2="404.6709" y1="126.5625" y2="2539.7969"/></g><g><title/><rect fill="#FFFFFF" height="144.8438" style="stroke:#181818;stroke-width:1;" width="10" x="399.6709" y="478.5313"/></g><g><title>TPM</title><rect fill="#000000" fill-opacity="0.00000" height="2413.2344" width="8" x="773.8877" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="777.3877" x2="777.3877" y1="126.5625" y2="2539.7969"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="772.3877" y="533.4531"/></g><g><title>Konnektor or</title><rect fill="#000000" fill-opacity="0.00000" height="2413.2344" width="8" x="850.6978" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="854.1978" x2="854.1978" y1="126.5625" y2="2539.7969"/></g><g><title/><rect fill="#FFFFFF" height="76.9219" style="stroke:#181818;stroke-width:1;" width="10" x="849.1978" y="1030.3125"/></g><g><title>SM(C)-B</title><rect fill="#000000" fill-opacity="0.00000" height="2413.2344" width="8" x="982.4478" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="985.9478" x2="985.9478" y1="126.5625" y2="2539.7969"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="980.9478" y="1055.9531"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2413.2344" width="8" x="1088.0371" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1091.5371" x2="1091.5371" y1="126.5625" y2="2539.7969"/></g><g><title/><rect fill="#FFFFFF" height="25.6406" style="stroke:#181818;stroke-width:1;" width="10" x="1086.5371" y="248.7656"/></g><g><title/><rect fill="#FFFFFF" height="1176.5938" style="stroke:#181818;stroke-width:1;" width="10" x="1086.5371" y="1331.2031"/></g><g><title>PDP</title><rect fill="#000000" fill-opacity="0.00000" height="2413.2344" width="8" x="1411.1689" y="126.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1414.6689" x2="1414.6689" y1="126.5625" y2="2539.7969"/></g><g><title/><rect fill="#FFFFFF" height="60.5625" style="stroke:#181818;stroke-width:1;" width="10" x="1409.6689" y="2117.625"/></g><text fill="#000000" font-family="Helvetica" font-size="10" x="5" y="124.2041">User</text><ellipse cx="19.3965" cy="63.4219" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M19.3965,71.4219 L19.3965,98.4219 M6.3965,79.4219 L32.3965,79.4219 M19.3965,98.4219 L6.3965,113.4219 M19.3965,98.4219 L32.3965,113.4219" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="62.8179" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="71.2339" y="104.5635">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="69.8179" y="116.2041">Client</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.6826" x="335.3296" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="342.3296" y="104.5635">ZETA Attestation Service</text><text fill="#000000" font-family="Helvetica" font-size="10" x="368.8042" y="116.2041">(Admin rights)</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="760.0044" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="767.0044" y="116.2041">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="814.771" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="821.771" y="104.5635">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="825.7773" y="116.2041">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="958.833" y="99.9219"/><text fill="#000000" font-family="Helvetica" font-size="10" x="965.833" y="116.2041">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1033.0625" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1081.6567" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1040.0625" y="116.2041">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1374.3828" y="88.2813"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1404.7886" y="104.5635">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1381.3828" y="116.2041">Policy Engine</text><text fill="#000000" font-family="Helvetica" font-size="10" x="5" y="2609.0791">User</text><ellipse cx="19.3965" cy="2548.2969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M19.3965,2556.2969 L19.3965,2583.2969 M6.3965,2564.2969 L32.3965,2564.2969 M19.3965,2583.2969 L6.3965,2598.2969 M19.3965,2583.2969 L32.3965,2598.2969" fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42.9502" x="62.8179" y="2539.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="71.2339" y="2556.0791">ZETA</text><text fill="#000000" font-family="Helvetica" font-size="10" x="69.8179" y="2567.7197">Client</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.6826" x="335.3296" y="2539.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="342.3296" y="2556.0791">ZETA Attestation Service</text><text fill="#000000" font-family="Helvetica" font-size="10" x="368.8042" y="2567.7197">(Admin rights)</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.7666" x="760.0044" y="2539.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="767.0044" y="2556.0791">TPM</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78.8535" x="814.771" y="2539.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="821.771" y="2556.0791">Konnektor or</text><text fill="#000000" font-family="Helvetica" font-size="10" x="825.7773" y="2567.7197">TI-Gateway</text><rect fill="#E2E2F0" height="25.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.2295" x="958.833" y="2539.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="965.833" y="2556.0791">SM(C)-B</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.9492" x="1033.0625" y="2539.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1081.6567" y="2556.0791">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1040.0625" y="2567.7197">Authorization Server</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.5723" x="1374.3828" y="2539.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1404.7886" y="2556.0791">PDP</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1381.3828" y="2567.7197">Policy Engine</text><path d="M68.293,138.5625 L128.249,138.5625 L128.249,142.2031 L118.249,152.2031 L68.293,152.2031 L68.293,138.5625" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="78.5625" style="stroke:#000000;stroke-width:1.5;" width="373.3096" x="68.293" y="138.5625"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="83.293" y="148.8447">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="143.249" y="149.8447">[Client has no Client Instance Key]</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="191.4844" y2="191.4844"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="191.4844" y2="204.4844"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="204.4844" y2="204.4844"/><polygon fill="#181818" points="100.293,200.4844,90.293,204.4844,100.293,208.4844,96.293,204.4844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="181.3057">(01)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="175.4854">Generate Client Instance</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="187.126">Key Pair (for Client Auth)</text><path d="M257.3662,167.2031 L257.3662,211.2031 L420.3662,211.2031 L420.3662,177.2031 L410.3662,167.2031 L257.3662,167.2031" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M410.3662,167.2031 L410.3662,177.2031 L420.3662,177.2031 L410.3662,167.2031" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="263.3662" y="181.4854">Key Pair for private_key_jwt</text><text fill="#000000" font-family="Helvetica" font-size="10" x="263.3662" y="193.126">(Public Key MUST be bound</text><text fill="#000000" font-family="Helvetica" font-size="10" x="263.3662" y="204.7666">to TPM Attestation)</text><polygon fill="#181818" points="1074.5371,244.7656,1084.5371,248.7656,1074.5371,252.7656,1078.5371,248.7656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="1080.5371" y1="248.7656" y2="248.7656"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="244.4072">(02)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="244.4072">GET /nonce</text><polygon fill="#181818" points="100.293,270.4063,90.293,274.4063,100.293,278.4063,96.293,274.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="94.293" x2="1085.5371" y1="274.4063" y2="274.4063"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="270.0479">(03)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="270.0479">return 200 OK new-nonce: nonce</text><path d="M68.293,286.4063 L128.249,286.4063 L128.249,290.0469 L118.249,300.0469 L68.293,300.0469 L68.293,286.4063" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1771.9375" style="stroke:#000000;stroke-width:1.5;" width="1287.2881" x="68.293" y="286.4063"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="83.293" y="296.6885">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="143.249" y="297.6885">[ZETA Client uses SM(C)-B Access Token (Initial Token Exchange with Attestation)]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="68.293" x2="1355.5811" y1="1606.25" y2="1606.25"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="73.293" y="1617.5322">[ZETA Client uses Refresh Token (Renewal without Attestation)]</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="327.6875" y2="327.6875"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="327.6875" y2="340.6875"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="340.6875" y2="340.6875"/><polygon fill="#181818" points="100.293,336.6875,90.293,340.6875,100.293,344.6875,96.293,340.6875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="323.3291">(04)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="323.3291">Create DPoP Key Pair (for Token Exchange)</text><path d="M349.9932,315.0469 L349.9932,336.0469 L575.9932,336.0469 L575.9932,325.0469 L565.9932,315.0469 L349.9932,315.0469" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M565.9932,315.0469 L565.9932,325.0469 L575.9932,325.0469 L565.9932,315.0469" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="355.9932" y="329.3291">Session-based Key Pair for DPoP binding.</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="377.9688" y2="377.9688"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="377.9688" y2="390.9688"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="390.9688" y2="390.9688"/><polygon fill="#181818" points="100.293,386.9688,90.293,390.9688,100.293,394.9688,96.293,390.9688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="367.79">(05)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="361.9697">Calculate Public Key Hash</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="373.6104">(e.g., SHA256(PublicKeyJWK))</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="428.25" y2="428.25"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="428.25" y2="441.25"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="441.25" y2="441.25"/><polygon fill="#181818" points="100.293,437.25,90.293,441.25,100.293,445.25,96.293,441.25" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="418.0713">(06)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="412.251">Calculate attestation_challenge for TPM</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="423.8916">`attestation_challenge = HASH(pubKeyHash + nonce)`</text><polygon fill="#181818" points="387.6709,474.5313,397.6709,478.5313,387.6709,482.5313,391.6709,478.5313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="393.6709" y1="478.5313" y2="478.5313"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="468.3525">(07)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="462.5322">Get Attestation</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="474.1729">with `attestation_challenge`</text><path d="M414.6709,454.25 L414.6709,498.25 L635.6709,498.25 L635.6709,464.25 L625.6709,454.25 L414.6709,454.25" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M625.6709,454.25 L625.6709,464.25 L635.6709,464.25 L625.6709,454.25" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="420.6709" y="468.5322">Die TPM-Attestierung wird nur beim</text><text fill="#000000" font-family="Helvetica" font-size="10" x="420.6709" y="480.1729">initialen Token-Austausch durchgef&#252;hrt,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="420.6709" y="491.8135">um die Integrit&#228;t des Clients zu pr&#252;fen.</text><polygon fill="#181818" points="760.3877,529.4531,770.3877,533.4531,760.3877,537.4531,764.3877,533.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="409.6709" x2="766.3877" y1="533.4531" y2="533.4531"/><text fill="#000000" font-family="Helvetica" font-size="10" x="416.6709" y="523.2744">(08)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="441.1982" y="517.4541">Get TPM Quote for PCRs (4, 5, 7, 10, 11, 22 or 23)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="441.1982" y="529.0947">and `attestation_challenge` (as qualifyingData), signed with AK</text><polygon fill="#181818" points="420.6709,555.0938,410.6709,559.0938,420.6709,563.0938,416.6709,559.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="414.6709" x2="771.3877" y1="559.0938" y2="559.0938"/><text fill="#000000" font-family="Helvetica" font-size="10" x="426.6709" y="554.7354">(09)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="451.1982" y="554.7354">Return TPM Quote</text><line style="stroke:#181818;stroke-width:1;" x1="409.6709" x2="451.6709" y1="584.7344" y2="584.7344"/><line style="stroke:#181818;stroke-width:1;" x1="451.6709" x2="451.6709" y1="584.7344" y2="597.7344"/><line style="stroke:#181818;stroke-width:1;" x1="410.6709" x2="451.6709" y1="597.7344" y2="597.7344"/><polygon fill="#181818" points="420.6709,593.7344,410.6709,597.7344,420.6709,601.7344,416.6709,597.7344" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="416.6709" y="580.376">(10)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="441.1982" y="580.376">Get TCG Event Log</text><polygon fill="#181818" points="100.293,619.375,90.293,623.375,100.293,627.375,96.293,623.375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="94.293" x2="398.6709" y1="623.375" y2="623.375"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="619.0166">(11)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="619.0166">Return Attestation (Quote, EventLog, CertChain)</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="683.9375" y2="683.9375"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="683.9375" y2="696.9375"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="696.9375" y2="696.9375"/><polygon fill="#181818" points="100.293,692.9375,90.293,696.9375,100.293,700.9375,96.293,696.9375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="662.1182">(12)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="644.6572">Create Client Statement JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="656.2979">with posture-tpm,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="667.9385">includes Attestation</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="679.5791">Signed with Client Instance Key</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="722.5781" y2="722.5781"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="722.5781" y2="735.5781"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="735.5781" y2="735.5781"/><polygon fill="#181818" points="100.293,731.5781,90.293,735.5781,100.293,739.5781,96.293,735.5781" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="718.2197">(13)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="718.2197">Create Client Assertion JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="261.5576" y="718.2197">with Attestation</text><path d="M365.3643,709.9375 L365.3643,870.9375 L680.3643,870.9375 L680.3643,719.9375 L670.3643,709.9375 L365.3643,709.9375" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M670.3643,709.9375 L670.3643,719.9375 L680.3643,719.9375 L670.3643,709.9375" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="371.3643" y="724.2197">Client Assertion JWT Claims (with Attestation):</text><text fill="#000000" font-family="Helvetica" font-size="10" x="371.3643" y="735.8604">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="747.501">"iss": "&lt;client_id&gt;", "sub": "&lt;client_id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="759.1416">"aud": "&lt;AS_Token_Endpoint_URL&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="770.7822">"exp": ..., "jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="782.4229">"cnf": { "jkt": "&lt;DPoP_Key_Thumbprint&gt;" },</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="794.0635">// Embed the fresh attestation</text><text fill="#000000" font-family="Helvetica" font-size="10" x="377.7217" y="805.7041">"urn:gematik:params:oauth:client-attestation:tpm2": {</text><text fill="#000000" font-family="Helvetica" font-size="10" x="387.2578" y="817.3447">"attestation_data": "&lt;Base64(Client Statement JWT)&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="387.2578" y="828.9854">"client_statement_format": "client-statement-jwt"</text><text fill="#000000" font-family="Helvetica" font-size="10" x="380.9004" y="840.626">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="371.3643" y="852.2666">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="371.3643" y="863.9072">(sig by Client_Instance_Private_Key)</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="893.9063" y2="893.9063"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="893.9063" y2="906.9063"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="906.9063" y2="906.9063"/><polygon fill="#181818" points="100.293,902.9063,90.293,906.9063,100.293,910.9063,96.293,906.9063" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="889.5479">(14)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="889.5479">Create "SM(C)-B Access Token" (JWT)</text><path d="M320.0762,881.2656 L320.0762,1007.2656 L753.0762,1007.2656 L753.0762,891.2656 L743.0762,881.2656 L320.0762,881.2656" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M743.0762,881.2656 L743.0762,891.2656 L753.0762,891.2656 L743.0762,881.2656" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="326.0762" y="895.5479">SM(C)-B Access Token Claims:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="326.0762" y="907.1885">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="918.8291">"iss": "&lt;client_id&gt;", // Issuer is the client</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="930.4697">"sub": "&lt;Telematik-ID from SM(C)-B&gt;", // Subject is the institution</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="942.1104">"aud": "[&lt;Resource_Server_Endpoint_URL&gt;]", // Audience is the Resource Server</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="953.751">"exp": ..., // Short-lived</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="965.3916">"iat": ...,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="977.0322">"jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="332.4336" y="988.6729">"scope": ... // As required for the Resource Server access</text><text fill="#000000" font-family="Helvetica" font-size="10" x="326.0762" y="1000.3135">}</text><polygon fill="#181818" points="837.1978,1026.3125,847.1978,1030.3125,837.1978,1034.3125,841.1978,1030.3125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="843.1978" y1="1030.3125" y2="1030.3125"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1025.9541">(15)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1025.9541">externalAuthenticate (JWT-hash)</text><polygon fill="#181818" points="968.9478,1051.9531,978.9478,1055.9531,968.9478,1059.9531,972.9478,1055.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="859.1978" x2="974.9478" y1="1055.9531" y2="1055.9531"/><text fill="#000000" font-family="Helvetica" font-size="10" x="866.1978" y="1051.5947">(16)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="890.7251" y="1051.5947">sign (JWT-hash)</text><polygon fill="#181818" points="870.1978,1077.5938,860.1978,1081.5938,870.1978,1085.5938,866.1978,1081.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="864.1978" x2="979.9478" y1="1081.5938" y2="1081.5938"/><text fill="#000000" font-family="Helvetica" font-size="10" x="876.1978" y="1077.2354">(17)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="900.7251" y="1077.2354">JWT-Signature</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="1107.2344" y2="1103.2344"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="1107.2344" y2="1111.2344"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="848.1978" y1="1107.2344" y2="1107.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="1102.876">(18)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="1102.876">JWT-signature</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="1132.875" y2="1132.875"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="1132.875" y2="1145.875"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="1145.875" y2="1145.875"/><polygon fill="#181818" points="100.293,1141.875,90.293,1145.875,100.293,1149.875,96.293,1145.875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1128.5166">(19)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1128.5166">Add JWT-Signature to SM(C)-B Access Token</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="1171.5156" y2="1171.5156"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="1171.5156" y2="1184.5156"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="1184.5156" y2="1184.5156"/><polygon fill="#181818" points="100.293,1180.5156,90.293,1184.5156,100.293,1188.5156,96.293,1184.5156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1167.1572">(20)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1167.1572">Create DPoP Proof JWT for Token Exchange</text><path d="M349.3584,1158.875 L349.3584,1307.875 L627.3584,1307.875 L627.3584,1168.875 L617.3584,1158.875 L349.3584,1158.875" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M617.3584,1158.875 L617.3584,1168.875 L627.3584,1168.875 L617.3584,1158.875" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="355.3584" y="1173.1572">DPoP Proof JWT Claims (for Token Exchange):</text><text fill="#000000" font-family="Helvetica" font-size="10" x="355.3584" y="1184.7979">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1196.4385">"typ": "dpop+jwt",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1208.0791">"alg": "ES256",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1219.7197">"jwk": { ... }</text><text fill="#000000" font-family="Helvetica" font-size="10" x="355.3584" y="1231.3604">}.{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1243.001">"jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1254.6416">"htm": "POST",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1266.2822">"htu": "&lt;AS_Token_Endpoint_URL&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1277.9229">"nonce": "&lt;nonce from AS&gt;", // Binding to AS</text><text fill="#000000" font-family="Helvetica" font-size="10" x="361.7158" y="1289.5635">"iat": ...</text><text fill="#000000" font-family="Helvetica" font-size="10" x="355.3584" y="1301.2041">}.(sig by DPoP_Private_Key)</text><polygon fill="#181818" points="1074.5371,1327.2031,1084.5371,1331.2031,1074.5371,1335.2031,1078.5371,1331.2031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="1080.5371" y1="1331.2031" y2="1331.2031"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1326.8447">(21)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1326.8447">POST /token (RFC 8693) DPoP: &lt;signed_dpop_jwt&gt;</text><path d="M94.293,1344.2031 L94.293,1435.2031 L507.293,1435.2031 L507.293,1354.2031 L497.293,1344.2031 L94.293,1344.2031" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M497.293,1344.2031 L497.293,1354.2031 L507.293,1354.2031 L497.293,1344.2031" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="100.293" y="1358.4854">Token Exchange Request Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1370.126">grant_type=urn:ietf:params:oauth:grant-type:token-exchange</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1381.7666">&amp;subject_token=&lt;SM(C)-B_Access_Token&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1393.4072">&amp;subject_token_type=urn:ietf:params:oauth:token-type:jwt</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1405.0479">&amp;client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1416.6885">&amp;client_assertion=&lt;Client_Assertion_JWT_</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="312.8564" y="1416.6885">with</text><text fill="#000000" font-family="Helvetica" font-size="10" x="337.4219" y="1416.6885">_Attestation&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1428.3291">...</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1458.3281" y2="1458.3281"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1458.3281" y2="1471.3281"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1471.3281" y2="1471.3281"/><polygon fill="#181818" points="1107.5371,1467.3281,1097.5371,1471.3281,1107.5371,1475.3281,1103.5371,1471.3281" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1453.9697">(22)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1453.9697">Validate subject_token (sig, claims)</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1496.9688" y2="1496.9688"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1496.9688" y2="1509.9688"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1509.9688" y2="1509.9688"/><polygon fill="#181818" points="1107.5371,1505.9688,1097.5371,1509.9688,1107.5371,1513.9688,1103.5371,1509.9688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1492.6104">(23)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1492.6104">Validate client_assertion (sig, claims)</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1535.6094" y2="1535.6094"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1535.6094" y2="1548.6094"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1548.6094" y2="1548.6094"/><polygon fill="#181818" points="1107.5371,1544.6094,1097.5371,1548.6094,1107.5371,1552.6094,1103.5371,1548.6094" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1531.251">(24)</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1128.0645" y="1531.251">Validate embedded TPM Attestation</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1574.25" y2="1574.25"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1574.25" y2="1587.25"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1587.25" y2="1587.25"/><polygon fill="#181818" points="1107.5371,1583.25,1097.5371,1587.25,1107.5371,1591.25,1103.5371,1587.25" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1569.8916">(25)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1569.8916">Validate DPoP Proof JWT</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="1642.5313" y2="1642.5313"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="1642.5313" y2="1655.5313"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="1655.5313" y2="1655.5313"/><polygon fill="#181818" points="100.293,1651.5313,90.293,1655.5313,100.293,1659.5313,96.293,1655.5313" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1638.1729">(26)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1638.1729">Create Client Assertion JWT</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="261.5576" y="1638.1729">without Attestation</text><path d="M384.1338,1629.8906 L384.1338,1755.8906 L687.1338,1755.8906 L687.1338,1639.8906 L677.1338,1629.8906 L384.1338,1629.8906" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M677.1338,1629.8906 L677.1338,1639.8906 L687.1338,1639.8906 L677.1338,1629.8906" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="390.1338" y="1644.1729">Client Assertion JWT Claims (without Attestation):</text><text fill="#000000" font-family="Helvetica" font-size="10" x="390.1338" y="1655.8135">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1667.4541">"iss": "&lt;client_id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1679.0947">"sub": "&lt;client_id&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1690.7354">"aud": "&lt;AS_Token_Endpoint_URL&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1702.376">"exp": ...,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1714.0166">"jti": "...",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="396.4912" y="1725.6572">"cnf": { "jkt": "&lt;DPoP_Key_Thumbprint&gt;" }</text><text fill="#000000" font-family="Helvetica" font-size="10" x="390.1338" y="1737.2979">}</text><text fill="#000000" font-family="Helvetica" font-size="10" x="390.1338" y="1748.9385">(sig by Client_Instance_Private_Key)</text><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="131.293" y1="1778.9375" y2="1778.9375"/><line style="stroke:#181818;stroke-width:1;" x1="131.293" x2="131.293" y1="1778.9375" y2="1791.9375"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="131.293" y1="1791.9375" y2="1791.9375"/><polygon fill="#181818" points="100.293,1787.9375,90.293,1791.9375,100.293,1795.9375,96.293,1791.9375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1774.5791">(27)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1774.5791">Create DPoP Proof JWT for Token Exchange</text><polygon fill="#181818" points="1074.5371,1813.5781,1084.5371,1817.5781,1074.5371,1821.5781,1078.5371,1817.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.293" x2="1080.5371" y1="1817.5781" y2="1817.5781"/><text fill="#000000" font-family="Helvetica" font-size="10" x="96.293" y="1813.2197">(28)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="120.8203" y="1813.2197">POST /token DPoP: &lt;signed_dpop_jwt&gt;</text><path d="M94.293,1830.5781 L94.293,1898.5781 L507.293,1898.5781 L507.293,1840.5781 L497.293,1830.5781 L94.293,1830.5781" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M497.293,1830.5781 L497.293,1840.5781 L507.293,1840.5781 L497.293,1830.5781" fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="100.293" y="1844.8604">Token Exchange Request Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1856.501">grant_type=refresh_token</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1868.1416">&amp;refresh_token=&lt;Refresh_Token&gt;</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1879.7822">&amp;client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer</text><text fill="#000000" font-family="Helvetica" font-size="10" x="100.293" y="1891.4229">&amp;client_assertion=&lt;Client_Assertion_JWT_</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="312.8564" y="1891.4229">without</text><text fill="#000000" font-family="Helvetica" font-size="10" x="356.1914" y="1891.4229">_Attestation&gt;</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1921.4219" y2="1921.4219"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1921.4219" y2="1934.4219"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1934.4219" y2="1934.4219"/><polygon fill="#181818" points="1107.5371,1930.4219,1097.5371,1934.4219,1107.5371,1938.4219,1103.5371,1934.4219" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1917.0635">(29)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1917.0635">Verify Refresh token</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1960.0625" y2="1960.0625"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1960.0625" y2="1973.0625"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="1973.0625" y2="1973.0625"/><polygon fill="#181818" points="1107.5371,1969.0625,1097.5371,1973.0625,1107.5371,1977.0625,1103.5371,1973.0625" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1955.7041">(30)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1955.7041">Invalidate Refresh token</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="1998.7031" y2="1998.7031"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="1998.7031" y2="2011.7031"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="2011.7031" y2="2011.7031"/><polygon fill="#181818" points="1107.5371,2007.7031,1097.5371,2011.7031,1107.5371,2015.7031,1103.5371,2011.7031" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="1994.3447">(31)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="1994.3447">Validate client_assertion (sig, claims)</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="2037.3438" y2="2037.3438"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="2037.3438" y2="2050.3438"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="2050.3438" y2="2050.3438"/><polygon fill="#181818" points="1107.5371,2046.3438,1097.5371,2050.3438,1107.5371,2054.3438,1103.5371,2050.3438" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="2032.9854">(32)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="2032.9854">Validate DPoP Proof JWT</text><path d="M49.293,2076.3438 L109.249,2076.3438 L109.249,2079.9844 L99.249,2089.9844 L49.293,2089.9844 L49.293,2076.3438" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="439.4531" style="stroke:#000000;stroke-width:1.5;" width="1406.376" x="49.293" y="2076.3438"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="64.293" y="2086.626">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="124.249" y="2087.626">[Validations Successful]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="49.293" x2="1455.6689" y1="2471.5156" y2="2471.5156"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="54.293" y="2482.7979">[Validation Failed]</text><polygon fill="#181818" points="1397.6689,2113.625,1407.6689,2117.625,1397.6689,2121.625,1401.6689,2117.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1403.6689" y1="2117.625" y2="2117.625"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="2113.2666">(33)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="2113.2666">POST /v1/data/authz, body {  "input": {...}}</text><polygon fill="#181818" points="1107.5371,2174.1875,1097.5371,2178.1875,1107.5371,2182.1875,1103.5371,2178.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1101.5371" x2="1408.6689" y1="2178.1875" y2="2178.1875"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.5371" y="2156.3682">(34)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1138.0645" y="2138.9072">200 OK, body {"allow": true,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1144.4219" y="2150.5479">"access_token_ttl": "360",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1144.4219" y="2162.1885">"refresh_token_ttl": "43200",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1144.4219" y="2173.8291">"scope": "RS specific scopes"}</text><path d="M68.293,2190.1875 L128.249,2190.1875 L128.249,2193.8281 L118.249,2203.8281 L68.293,2203.8281 L68.293,2190.1875" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="256.3281" style="stroke:#000000;stroke-width:1.5;" width="1362.376" x="68.293" y="2190.1875"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="83.293" y="2200.4697">alt</text><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="143.249" y="2201.4697">[Policy Decision allowed]</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="68.293" x2="1430.6689" y1="2402.2344" y2="2402.2344"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="73.293" y="2413.5166">[Policy Decision denied]</text><line style="stroke:#181818;stroke-width:1;" x1="1096.5371" x2="1138.5371" y1="2231.4688" y2="2231.4688"/><line style="stroke:#181818;stroke-width:1;" x1="1138.5371" x2="1138.5371" y1="2231.4688" y2="2244.4688"/><line style="stroke:#181818;stroke-width:1;" x1="1097.5371" x2="1138.5371" y1="2244.4688" y2="2244.4688"/><polygon fill="#181818" points="1107.5371,2240.4688,1097.5371,2244.4688,1107.5371,2248.4688,1103.5371,2244.4688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="Helvetica" font-size="10" x="1103.5371" y="2227.1104">(35)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1128.0645" y="2227.1104">Generate AS Access Token (AT) and Refresh Token (RT)</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2270.1094" y2="2266.1094"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2270.1094" y2="2274.1094"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="1085.5371" y1="2270.1094" y2="2270.1094"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="2265.751">(36)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="2265.751">200 OK, new tokens</text><path d="M1101.5371,2283.1094 L1101.5371,2386.1094 L1386.5371,2386.1094 L1386.5371,2293.1094 L1376.5371,2283.1094 L1101.5371,2283.1094" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><path d="M1376.5371,2283.1094 L1376.5371,2293.1094 L1386.5371,2293.1094 L1376.5371,2283.1094" fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Helvetica" font-size="10" font-weight="bold" x="1107.5371" y="2297.3916">Token Response Body:</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.5371" y="2309.0322">{</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2320.6729">"access_token": "&lt;AS_Access_Token&gt;",</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2332.3135">"token_type": "DPoP", // Indicate DPoP is required</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2343.9541">"expires_in": 3600,</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2355.5947">"refresh_token": "&lt;AS_Refresh_Token&gt;" // Optional</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1113.8945" y="2367.2354">// ... other parameters</text><text fill="#000000" font-family="Helvetica" font-size="10" x="1107.5371" y="2378.876">}</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2438.5156" y2="2434.5156"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2438.5156" y2="2442.5156"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="1085.5371" y1="2438.5156" y2="2438.5156"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="2434.1572">(37)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="2434.1572">403 Forbidden</text><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2507.7969" y2="2503.7969"/><line style="stroke:#181818;stroke-width:1;" x1="90.293" x2="100.293" y1="2507.7969" y2="2511.7969"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="89.293" x2="1085.5371" y1="2507.7969" y2="2507.7969"/><text fill="#000000" font-family="Helvetica" font-size="10" x="106.293" y="2503.4385">(38)</text><text fill="#000000" font-family="Helvetica" font-size="10" x="130.8203" y="2503.4385">400 Bad Request</text><!--SRC=[nLXxRzl84VzVdsBA0nf95ct7oQMjO1kWPSNsvM5LL1hqgaAt8bVInjHI8PTsb23VvZx6_PSlrfdTvKkIxQ2zGmqOf7PdPkVncyUIPIgMsNBA4t2QXuSjfv7U2BbY2Lj2o6SiYzJBM2fVVERmz73tvbksv739erkkHC0gDEU6vaqiutJ50XuMrBquImHFAhGHbtEryC8FMQf0nf9NzbB-CUCou4C-umczdB7WPfx4cGnxSHGdy7uXL9N1tsGeRJXg73nvZ52j8mxJE0eRJmuQZJ-j4ZPVCb0y_WmgoNYZuGKAJtsNeWNJ-1Cuh_jN3lnmiOXJPLG1qEk3H2o__PgawrJn9LAyPhTSXiW5O2b-xeyyw4M2IuNxFfFX-Yo9xwIc040jqQTYnQIoLC1ImpMMbasJebWIsDXa-jdp2mxmbEAfOah44YrFRaN0nxBfXKiX8H7pXKfRpfQ4qU2Dbe1FsYmFgXAzYgNaD-GK8Yr_nSbOZgxS2wRu7Lix6rp-cpDDxxzfzbhkcTF8XHklUd8gkE89EcRKxrs-lNvzVV7FHjLn5nbBmcs_LS_mChKmBXYS3yQIViQ9-5mw0ULlCGtw9SSWZaImXhwS2ych7YYKjO7Psskmg0ZJ0WN8EFzr9T7l22zunTSemgwwf_bR5owuv0cwQPDZB9451amaq9oXH-qssT52IJ965XsxBXI4HBTAn2sAczpmzUJ3dG8Cz22ReYcQxCqxVmHJ0Zdcq5YgM8UvWeyMcLUOXeeQF-xjaQhz4HnWYWQyOLRTqX3NxKB2LPP8E3eyXEjN8FcTgucxO7YqboguXopbALWCW1S4F4rX5Dzm2SqhAPHWaVtP_nGic9npk1DgKTUM8hZ3gxs4aq_F1_40wdwiIpG2gixqKGkKx4vPoiEwQxMqgP2XaFFz1d8-WPEJ4_17td3K1MyqwkFhwEhwBVZzddusOncjDQzQY1IXXi4ZdXrGG9rP56GHgLq9s2LB5nX2lZ_Vxu1_wHtz-CB64tT_Ul-grNf45YkzDK6R8wgtNAk4aH_BNtRldy2bvrysLzaKZo4TOCz4iVLBxJmgCtjxX69LZSjOwaZj5lxB1dpF1ITTNCEFtI6JSunq4eBC4WIhM8wbC7Z0oEdukHvs2vQbmGB2B0aMSpxxzjiYKPqnzZG8KU2LL7oU2FNjLuKjAxKgf_0vmmpvzjkCotrKWzH7AoW7SYle_UyPgKS-6lI6AJIVT-373lobWvqG_vzsuEW8AnmSFMkD9LQW- -o49jQ2ZncBn6oDa3bdYhKwa8gvH6GPABz29UX4r_gIqcXeqgXGfDGJ7rR9tWNqRoa6h-DvlbzFHYkbMlgRMbp7S29Z1teyKRq54_8U59aiiXi-Yk5BUllf_SX6U8MTBqkugrRB3aKfY3BoTWqAViNWtMNHv57_xVdkBAA4QJoKvdbjJB4nQqjHGMYtDwj5krr37lmGqMCQPTnstNPxfwHUnCGIOR1LVRfQ8lrziKy0HwIfqmNdED2Y9Y8yTJhWfDbqQxNaOLceTpr_el4zwSjm5GiaV3TyNQFadrP8kR-FrS3ve0HnuOygHI1dkFe5js-K5afbQuAEdemMEF1XVv3gr86l9Sl10VHn4WonI27g4uxPNW5qAHdnr9tp9QxUTFKObNPZXesWQunoAqnT1CGHgL5mQpChQH9YDcZrph3GldZUt0MoLjLqRPlnNfeJJJ17KH-IOtKejbniVax9_BLHVpOn3M6wjj2Pv82S36pxH7-rRCydn3oCFsTN4tEWIIOy2hcT3T10xllnXI6yIjCCftbiCnH6irjovVWRySX4qBqwnrZ7oxm1Mob-Dlt00vMB4UWNeR8w3YnQ_tKyv2dEy-WrCq_LKVjl8z3Bi1nJgbk9EO-TmNOYc_J0QKsvaRZbOSLq7MeYATTs9q4Qn2jkQBKIAGud7pEH8CXDDzvI19ZsVmKcksDVphXw9kAVS52LBAA122dm7eInfi2xE0ZgIQraG6wQV3KVTO4w7MtLvBikqX455L16PROkpJsj57nBcbP8T-3L2yEwHC09S1S07yQx7eG6IHpFT7tS7giU1Vs6XBp2xXZGTkQ0MXDM74JRQe_ol5fAepbjzNsSbAhh7-vkT5aaH1J5OF_BOq1Qg2Mj3gxzKNqv-yw2hQScJQlVJCvvlastCpDDKXWyVmVG2qNpUgMB-NSLgShWJjh3WJAZzV1b3_xwuc_FMbfM5uxDG38XPzADuNHZ90QCaPMw4SXsUsCy7zAj6g_nPt6upkCsJ_1YDS60yHFg7tYnczMRXoPmYQ2hDNHv2IA0FwUc84tqticn1Ul4WDKu_tG7vKCdccFqYMYlORRLbEMD_o7-lDtbj8KeTyfPOclQbiIJOzjhYk5YWj2Vc36btPvK1WjZK1x-8hnWOre4jml_mE4of9Ii6Q-xMmTx06LLwq6-JIqVPsst2sPEKqE8DNNZ4gb3V_-PzUHlD7YKyksBuP2RKSJU28TuJxx36o5vAyxKvYtmlneED-Jy7lFXfchVtSAtM_NlDoe-LkI-TsJy8sUentlATdMhLxRxozaVKSmI0q-JS2RZQqidnnR0jHhrVoupYCxjIdDlVS6KvGdUNOjKp6tT9BkIjtbkFqpwlrMU-me86S0YPJumMI8KcE8mgxl4B8kguWRzQbUyVNf0Lv43Sldd3amnsfW9cADobL4oVC5S-Kg8HpQtK8PksEOxLyw2WqSKto43VId6kp2bgkbHjX-fY5BhsOj3n-pMq99lFt-6KYr1FiCwGn_I5G_4J0IW5rE7529hxKVASzobhrQWbR0ZyvR_Ya-Ddh_nkSqRjO0-P6pMt56hAgaSE4lZiIYRMAT5EQbdc-4roJPFE2_l4Nd6uI2-mcZnMgRLA-Q6C_C2M1i2QbT5fnm2Y9W0Osz9E6y51OP4UI-eCcFbnALq8kWaZDXXJNGjSBagzMHtwAZh5Q6GHHLUNANvCyQxGW8wsUaxT-cwh_M6Jyb9lN4poY6NeXxaQcYU7pw3bt4o5TYQfSrlIWyjgamFUCb4T9yKSwDuZa4-Os5U2ij4AuZ-0m00]--></g></svg>